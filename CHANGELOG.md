# 更新日志

## [未发布] - 2026-02-12

### 新增功能

#### 发现朋友圈配额系统

为"发现有趣朋友圈"功能添加每日配额限制，提升用户体验并为商业化预留空间。

**核心特性：**
- ✅ 普通用户每天 3 次发现机会
- ✅ 购物用户每天 8 次发现机会（3 + 5 额外）
- ✅ 未登录用户无限制（但无访问历史）
- ✅ 每天 00:00 自动重置配额
- ✅ 友好的剩余次数提示
- ✅ 自定义配额超限消息支持

**技术实现：**
- 在 User 模型中扩展 `discoverQuota` 字段
- 零额外数据库查询（与用户查询合并）
- 自动日期对比重置，无需定时任务
- HTTP 429 状态码表示配额超限

**API 变化：**
- `GET /api/public/circles/random` 现在返回配额信息
- 配额超限时返回 429 状态码和详细提示
- 响应中新增 `quota` 字段

**测试覆盖：**
- 23 个测试用例全部通过
- 覆盖基础配额、购物用户、自动重置、友好提示等场景

**文档：**
- 详细功能文档：`docs/DISCOVER_QUOTA_FEATURE.md`
- 包含前端集成建议和扩展性设计

**未来扩展：**
- 支持会员等级系统
- 购物记录验证
- 临时配额提升活动
- 配额使用历史分析

---

### 修改的文件

- `models/User.js` - 添加 discoverQuota 字段和相关方法
- `controllers/randomCircle.controller.js` - 集成配额检查逻辑
- `tests/controllers/randomCircle.test.js` - 添加配额功能测试

### 新增的文件

- `docs/DISCOVER_QUOTA_FEATURE.md` - 功能详细文档

