# 产品转向记录

## 背景

本项目初始定位为多用户社交应用（类朋友圈），历经约半年开发，积累了完整的后端基础设施。

2026年2月，基于对个人开发者冷启动结构性困境的清醒判断，决定 all in AI 陪伴方向。
这不是推倒重来，而是在已有基础上转向。

---

## 我们做了什么（社交阶段核心资产）

### 用户体系
- 微信 openid 作为主键的用户模型（User / TempUser）
- `checkOpenid` / `checkTempOpenid` / `checkTempOpenidAutoCreate` 三级中间件
- 注册流程：TempUser → User 零迁移（openid 不变，数据自动归属）

### 内容系统
- Circle（朋友圈）：创建、设置、邀请码、公开/私密
- Post（帖子）：发布、图片、点赞、评论、@回复
- 七牛云图片上传与清理

### 社交功能
- 成员申请、审核、拒绝、移除
- 邀请码体系（公开/私密朋友圈）
- 订阅消息通知（新帖、新成员）

### Trial Onboarding（已完成，继续沿用）
- `POST /api/public/trial/circle` — 未注册用户创建圈子（自动创建 TempUser）
- `POST /api/public/trial/post` — 未注册用户发帖
- 注册后数据自动归属，无需迁移
- TempUser 兼容 owner 权限校验（populate null 问题已修复）

### 发现功能
- 随机推荐公开朋友圈（含图片过滤、访问历史、每日配额）
- TempUser / User 统一配额体系

### 工程质量
- 完整测试套件（17 个测试文件，297 个用例）
- 统一错误处理、catchAsync 包装
- 中国时区配额重置

---

## 我们放弃了什么

- 多用户共享朋友圈（成员体系）
- 邀请码流程
- 申请 / 审核 / 拒绝
- 订阅消息通知（暂时搁置）
- 随机发现公开朋友圈（冷启动工具，AI 陪伴场景下不再需要）

---

## 为什么转向

社交产品的冷启动是双边问题：内容需要用户，用户需要内容，个人开发者难以独立撑起。

AI 陪伴把冷启动从双边变成单边：用户来了，AI 就在。
每个用户拥有自己的私人空间，只和 AI 互动，不依赖其他用户的存在。

---

## 新方向：AI 陪伴

### 核心理念
每个用户有自己的私人空间（保留 circle 或改名），记录生活片段，AI 作为陪伴者：
- 主动评论用户的帖子
- 主动发布内容（有 tool 能力）
- 有记忆，真正理解这个用户

### 待决策
- [ ] circle 数据结构是否保留，还是改名为更贴合陪伴语义的概念
- [ ] AI agent 架构设计（记忆、tool、主动触发机制）
- [ ] TempUser trial 流程与新方向的对接

### 分支
后端工作在 `feature/ai-only-redesign` 分支进行。
