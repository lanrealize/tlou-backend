# Scripts ç›®å½•ç»“æ„

æœ¬ç›®å½•åŒ…å«äº†é¡¹ç›®çš„å„ç§è„šæœ¬ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»ç»„ç»‡ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ admin/              # ç®¡ç†å‘˜å’Œæ•°æ®è¿ç§»ç›¸å…³
â”œâ”€â”€ cleanup/            # æ•°æ®æ¸…ç†ç›¸å…³
â”œâ”€â”€ deploy/             # éƒ¨ç½²ç›¸å…³
â””â”€â”€ README.md           # æœ¬è¯´æ˜æ–‡ä»¶
```

## ğŸ”§ Admin (ç®¡ç†å‘˜è„šæœ¬)

ç®¡ç†å‘˜æƒé™è®¾ç½®å’Œæ•°æ®è¿ç§»è„šæœ¬ï¼š

- **`migrateData.js`** - æ•°æ®è¿ç§»è„šæœ¬ï¼Œç”¨äºç‰ˆæœ¬å‡çº§æ—¶çš„æ•°æ®æ ¼å¼è½¬æ¢
- **`migrateToOpenidPrimary.js`** - è¿ç§»åˆ°openidä½œä¸ºä¸»é”®çš„è„šæœ¬  
- **`setAdmin.js`** - è®¾ç½®ç”¨æˆ·ä¸ºç®¡ç†å‘˜
- **`setVirtualUsersAdmin.js`** - æ‰¹é‡è®¾ç½®è™šæ‹Ÿç”¨æˆ·ä¸ºç®¡ç†å‘˜

### ä½¿ç”¨æ–¹æ³•
```bash
# è®¾ç½®ç®¡ç†å‘˜
node scripts/admin/setAdmin.js <openid>

# è®¾ç½®è™šæ‹Ÿç”¨æˆ·ç®¡ç†å‘˜æƒé™
node scripts/admin/setVirtualUsersAdmin.js
```

## ğŸ§¹ Cleanup (æ¸…ç†è„šæœ¬)

æ•°æ®åº“æ¸…ç†å’Œç»´æŠ¤è„šæœ¬ï¼š

- **`checkDatabaseState.js`** - æ£€æŸ¥æ•°æ®åº“çŠ¶æ€å’Œæ•°æ®ä¸€è‡´æ€§
- **`cleanupOrphanData.js`** - æ¸…ç†å­¤å„¿æ•°æ®ï¼ˆå·²åˆ é™¤ç”¨æˆ·çš„æ®‹ä½™æ•°æ®ï¼‰
- **`cleanupTestUsers.js`** - æ¸…ç†æ‰€æœ‰testå¼€å¤´çš„æµ‹è¯•ç”¨æˆ· â­ **æ–°å¢**
- **`deleteAllCircles.js`** - åˆ é™¤æ‰€æœ‰æœ‹å‹åœˆï¼ˆæ…ç”¨ï¼‰
- **`deleteAllUsers.js`** - åˆ é™¤æ‰€æœ‰ç”¨æˆ·ï¼ˆæ…ç”¨ï¼‰

### ä½¿ç”¨æ–¹æ³•
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
node scripts/cleanup/checkDatabaseState.js

# æ¸…ç†å­¤å„¿æ•°æ®
node scripts/cleanup/cleanupOrphanData.js

# æ¸…ç†testç”¨æˆ·ï¼ˆæ¨èæµ‹è¯•åä½¿ç”¨ï¼‰
node scripts/cleanup/cleanupTestUsers.js

# âš ï¸ å±é™©æ“ä½œ - æ¸…ç©ºæ‰€æœ‰æ•°æ®
node scripts/cleanup/deleteAllCircles.js
node scripts/cleanup/deleteAllUsers.js
```

## ğŸš€ Deploy (éƒ¨ç½²è„šæœ¬)

é¡¹ç›®éƒ¨ç½²ç›¸å…³è„šæœ¬ï¼š

- **`deploy.sh`** - Linux/MacOS éƒ¨ç½²è„šæœ¬
- **`deploy.ps1`** - Windows PowerShell éƒ¨ç½²è„šæœ¬

### ä½¿ç”¨æ–¹æ³•
```bash
# Linux/MacOS
chmod +x scripts/deploy/deploy.sh
./scripts/deploy/deploy.sh

# Windows PowerShell
.\scripts\deploy\deploy.ps1
```

## âš ï¸ é‡è¦æç¤º

1. **ç”Ÿäº§ç¯å¢ƒæ…ç”¨**ï¼šæ‰€æœ‰æ¸…ç†è„šæœ¬éƒ½ä¼šç›´æ¥æ“ä½œç”Ÿäº§æ•°æ®åº“ï¼Œè¯·ç¡®ä¿åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚

2. **å¤‡ä»½æ•°æ®**ï¼šæ‰§è¡Œä»»ä½•æ¸…ç†æ“ä½œå‰ï¼Œå»ºè®®å…ˆå¤‡ä»½é‡è¦æ•°æ®ã€‚

3. **ç¯å¢ƒå˜é‡**ï¼šç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„ `MONGODB_URI` é…ç½®æ­£ç¡®ã€‚

4. **æƒé™æ£€æŸ¥**ï¼šéƒ¨åˆ†è„šæœ¬éœ€è¦ç®¡ç†å‘˜æƒé™æˆ–ç‰¹å®šç¯å¢ƒå˜é‡ã€‚

## ğŸ¯ æœ€æ–°æ›´æ–°

### v2.0 (2025-10-26)
- âœ… é‡æ–°ç»„ç»‡scriptsç›®å½•ç»“æ„
- âœ… æ–°å¢ `cleanupTestUsers.js` è„šæœ¬
- âœ… ä¿®å¤è™šæ‹Ÿç”¨æˆ·åˆ é™¤æ—¶çš„æ•°æ®æ¸…ç†é—®é¢˜
- âœ… æ‰€æœ‰æ¸…ç†è„šæœ¬ç°åœ¨ä½¿ç”¨ç»Ÿä¸€çš„ `cleanupUserData` å‡½æ•°

### æ¸…ç†æ•ˆæœ
åˆšåˆšçš„æ¸…ç†æ“ä½œç»“æœï¼š
- âœ… åˆ é™¤äº† 2 ä¸ªtestç”¨æˆ·
- âœ… å½“å‰æ•°æ®åº“åªå‰©3ä¸ªç”¨æˆ·ï¼ˆ1ä¸ªä¸»ç®¡ç†å‘˜ + 2ä¸ªè™šæ‹Ÿç”¨æˆ·ï¼‰
- âœ… æ•°æ®åº“çŠ¶æ€å¹²å‡€ï¼Œé€‚åˆå‰ç«¯æµ‹è¯•
